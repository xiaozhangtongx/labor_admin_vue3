import{R as e,d as t,t as n,r as o,a2 as a,o as i,S as l,bl as r,bm as s,U as u,bn as d,a_ as c,ad as m,ac as p,Q as f,a as g,c as v,D as y,l as b,w as h,C as j,k as _,f as C,H as x,W as S,ah as w,a4 as V,q as E,aM as D,an as M}from"./index-9a706b5e.js";import{v as k}from"./el-loading-9a7b0add.js";import{E as I}from"./el-dialog-94ce5d08.js";import"./el-overlay-d6f3b381.js";import{E as A}from"./el-scrollbar-c33e6783.js";import{E as U}from"./el-divider-333d043c.js";import{_ as O}from"./index.vue_vue_type_script_setup_true_lang-ee812c46.js";import{E as P}from"./el-card-1dc32f2e.js";import{a as L,E as B}from"./el-form-item-ea286b40.js";import{E as F}from"./el-button-cb2bce56.js";/* empty css                 *//* empty css               */import{E as z,a as q}from"./el-select-cf6a8710.js";import"./el-popper-9f38ba83.js";import{a as H,e as R,b as K}from"./index-5fd24183.js";import{b as N}from"./utils-bb4bb7e7.js";import{E as G}from"./index-e3536c2f.js";import"./focus-trap-4f47c9e6.js";import"./event-15d81b97.js";import"./refs-b9a36019.js";import"./use-form-item-14a057db.js";import"./scroll-8c03f05f.js";import"./index-69566457.js";import"./_Uint8Array-c1224f14.js";import"./_initCloneObject-ee341c84.js";import"./strings-0eeb67c0.js";import"./isEqual-8163224d.js";import"./debounce-de061bf0.js";import"./index-8785ff64.js";import"./validator-1ce7f714.js";import"./index-c887b90a.js";var Y,T=["onActivate","onAddUndo","onBeforeAddUndo","onBeforeExecCommand","onBeforeGetContent","onBeforeRenderUI","onBeforeSetContent","onBeforePaste","onBlur","onChange","onClearUndos","onClick","onContextMenu","onCopy","onCut","onDblclick","onDeactivate","onDirty","onDrag","onDragDrop","onDragEnd","onDragGesture","onDragOver","onDrop","onExecCommand","onFocus","onFocusIn","onFocusOut","onGetContent","onHide","onInit","onKeyDown","onKeyPress","onKeyUp","onLoadContent","onMouseDown","onMouseEnter","onMouseLeave","onMouseMove","onMouseOut","onMouseOver","onMouseUp","onNodeChange","onObjectResizeStart","onObjectResized","onObjectSelected","onPaste","onPostProcess","onPostRender","onPreProcess","onProgressState","onRedo","onRemove","onReset","onSaveContent","onSelectionChange","onSetAttrib","onSetContent","onShow","onSubmit","onUndo","onVisualAid"],Q=function(e){return-1!==T.map((function(e){return e.toLowerCase()})).indexOf(e.toLowerCase())},W=function(t,n,o,a,i,l){a.setContent(l()),o.attrs["onUpdate:modelValue"]&&function(t,n,o,a){var i=t.modelEvents?t.modelEvents:null,l=Array.isArray(i)?i.join(" "):i;e(a,(function(e,n){o&&"string"==typeof e&&e!==n&&e!==o.getContent({format:t.outputFormat})&&o.setContent(e)})),o.on(l||"change input undo redo",(function(){n.emit("update:modelValue",o.getContent({format:t.outputFormat}))}))}(n,o,a,i),function(e,t,n){Object.keys(t).filter(Q).forEach((function(o){var a=t[o];"function"==typeof a&&("onInit"===o?a(e,n):n.on(o.substring(2),(function(e){return a(e,n)})))}))}(t,o.attrs,a)},J=0,$=function(e){var t=Date.now();return e+"_"+Math.floor(1e9*Math.random())+ ++J+String(t)},X=function(e){return void 0===e||""===e?[]:Array.isArray(e)?e:e.split(" ")},Z=function(){return{listeners:[],scriptId:$("tiny-script"),scriptLoaded:!1}},ee=(Y=Z(),{load:function(e,t,n){Y.scriptLoaded?n():(Y.listeners.push(n),e.getElementById(Y.scriptId)||function(e,t,n,o){var a=t.createElement("script");a.referrerPolicy="origin",a.type="application/javascript",a.id=e,a.src=n;var i=function(){a.removeEventListener("load",i),o()};a.addEventListener("load",i),t.head&&t.head.appendChild(a)}(Y.scriptId,e,t,(function(){Y.listeners.forEach((function(e){return e()})),Y.scriptLoaded=!0})))},reinitialize:function(){Y=Z()}}),te=function(){var e="undefined"!=typeof window?window:global;return e&&e.tinymce?e.tinymce:null},ne={apiKey:String,cloudChannel:String,id:String,init:Object,initialValue:String,inline:Boolean,modelEvents:[String,Array],plugins:[String,Array],tagName:String,toolbar:[String,Array],modelValue:String,disabled:Boolean,tinymceScriptSrc:String,outputFormat:{type:String,validator:function(e){return"html"===e||"text"===e}}},oe=globalThis&&globalThis.__assign||function(){return oe=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},oe.apply(this,arguments)},ae=t({props:ne,setup:function(t,d){var c=t.init?oe({},t.init):{},m=n(t),p=m.disabled,f=m.modelValue,g=m.tagName,v=o(null),y=null,b=t.id||$("tiny-vue"),h=t.init&&t.init.inline||t.inline,j=!!d.attrs["onUpdate:modelValue"],_=!0,C=t.initialValue?t.initialValue:"",x="",S=function(){var e,n,o,a=(e=_,j?function(){return(null==f?void 0:f.value)?f.value:""}:function(){return e?C:x}),i=oe(oe({},c),{readonly:t.disabled,target:v.value,plugins:(n=c.plugins,o=t.plugins,X(n).concat(X(o))),toolbar:t.toolbar||c.toolbar,inline:h,setup:function(e){y=e,e.on("init",(function(n){return W(n,t,d,e,f,a)})),"function"==typeof c.setup&&c.setup(e)}});(function(e){return null!==e&&"textarea"===e.tagName.toLowerCase()})(v.value)&&(v.value.style.visibility=""),te().init(i),_=!1};e(p,(function(e){var t;null!==y&&("function"==typeof(null===(t=y.mode)||void 0===t?void 0:t.set)?y.mode.set(e?"readonly":"design"):y.setMode(e?"readonly":"design"))})),e(g,(function(e){var t;j||(x=y.getContent()),null===(t=te())||void 0===t||t.remove(y),a((function(){return S()}))})),i((function(){if(null!==te())S();else if(v.value&&v.value.ownerDocument){var e=t.cloudChannel?t.cloudChannel:"6",n=t.apiKey?t.apiKey:"no-api-key",o=null==t.tinymceScriptSrc?"https://cdn.tiny.cloud/1/".concat(n,"/tinymce/").concat(e,"/tinymce.min.js"):t.tinymceScriptSrc;ee.load(v.value.ownerDocument,o,S)}})),l((function(){null!==te()&&te().remove(y)})),h||(r((function(){_||S()})),s((function(){var e;j||(x=y.getContent()),null===(e=te())||void 0===e||e.remove(y)})));return d.expose({rerender:function(e){var t;x=y.getContent(),null===(t=te())||void 0===t||t.remove(y),c=oe(oe({},c),e),a((function(){return S()}))},getEditor:function(){return y}}),function(){return h?function(e,t,n,o){return e(o||"div",{id:t,ref:n})}(u,b,v,t.tagName):u("textarea",{id:b,visibility:"hidden",ref:v})}}});const ie=e=>{if(e&&Array.isArray(e)&&e.length>0){const t=d().roles,n=e;return t.some((e=>n.includes(e)))}return console.error("need roles! Like v-permission=\"['admin','editor']\""),!1};const le={class:"app-container"},re={class:"w-1920px"},se={class:"text-center"},ue={class:"text-center"},de=_("strong",null,"发布者：",-1),ce={class:"text-blue-400"},me=_("strong",{class:"ml-30px"},"发布时间：",-1),pe=_("strong",{class:"ml-30px"},"类型：",-1),fe=["innerHTML"],ge=t({__name:"index",setup(e){var t;const n=m(),a=o(),l=o("default"),r=o(!1),s=o(!1),u=p(),d=[{id:0,value:"安全公告",type:""},{id:1,value:"学习公告",type:"success"},{id:2,value:"考试公告",type:"danger"}],Y=o({plugins:"lists link image table code help wordcount a11ychecker",language_url:"tinymce/langs/zh-Hans.js",language:"zh-Hans",toolbar:"undo redo | styleselect | bold italic | link image a11ycheck | formatselect |  alignleft aligncenter alignright | bullist numlist outdent indent | help",branding:!1,elementpath:!1,automatic_uploads:!0,images_reuse_filename:!0,plugin_preview_width:375,paste_data_images:!0,images_upload_handler:e=>new Promise(((t,n)=>{const o=e.blob().type,a="image/jpeg"===o||"image/png"===o||"image/GIF"===o||"image/jpg"===o||"image/BMP"===o;e.blob().size/1024/1024>5?M.warning("上传失败，图片大小请控制在 5M 以内"):a?N(e.blob()).then((e=>{var o;(o=[e],c({url:"sys-upload/images",method:"post",data:o})).then((e=>{t(e.data[0])})).catch((e=>{n(e)}))})):M.warning("图片格式错误")})),placeholder:"请输入公告内容",content_style:"body { font-family:Helvetica,Arial,sans-serif; font-size:16px }"}),T=f({title:[{required:!0,message:"请输入公告信息",trigger:"blur"},{min:3,max:50,message:"字数在3-50内",trigger:"blur"}],content:[{required:!0,message:"请输入公告内容",trigger:"blur"}],type:[{required:!0,message:"请选择公告类型",trigger:"change"}]}),Q=f({id:"",title:"",creatorId:null==(t=u.userInfo)?void 0:t.id,deptId:"",teamId:"",type:0,content:""}),W=()=>{void 0!==n.query.id&&H(n.query.id).then((e=>Object.assign(Q,e.data)))};return i((()=>{W()})),(e,t)=>{const o=G,i=L,c=z,m=q,p=F,f=B,H=P,N=O,J=U,$=A,X=I,Z=k;return g(),v("div",le,[y((g(),b(H,null,{default:h((()=>[j(f,{ref_key:"noticeFormRef",ref:a,"label-position":"left",model:Q,rules:T,"label-width":"130px",class:"demo-noticeForm",size:l.value,"status-icon":""},{default:h((()=>[j(i,{label:"公告标题",prop:"title"},{default:h((()=>[j(o,{modelValue:Q.title,"onUpdate:modelValue":t[0]||(t[0]=e=>Q.title=e)},null,8,["modelValue"])])),_:1}),j(i,{label:"公告内容",prop:"content"},{default:h((()=>[_("div",re,[j(C(ae),{modelValue:Q.content,"onUpdate:modelValue":t[1]||(t[1]=e=>Q.content=e),"api-key":"u7329yvue4st3dqwrb26xf5pcbw9oma45cp1p9lzev0b4oal",init:Y.value},null,8,["modelValue","init"])])])),_:1}),C(ie)(["admin","pm","safety"])?(g(),b(i,{key:0,label:"接收部门"},{default:h((()=>[j(o,{modelValue:Q.deptId,"onUpdate:modelValue":t[2]||(t[2]=e=>Q.deptId=e)},null,8,["modelValue"])])),_:1})):x("",!0),C(ie)(["admin","pm","leader","safety"])?(g(),b(i,{key:1,label:"接收小组"},{default:h((()=>[j(o,{modelValue:Q.teamId,"onUpdate:modelValue":t[3]||(t[3]=e=>Q.teamId=e)},null,8,["modelValue"])])),_:1})):x("",!0),j(i,{label:"公告类型",prop:"type"},{default:h((()=>[j(m,{modelValue:Q.type,"onUpdate:modelValue":t[4]||(t[4]=e=>Q.type=e),clearable:"",placeholder:"请选择公告类型"},{default:h((()=>[(g(),v(S,null,w(d,(e=>j(c,{key:e.id,label:e.value,value:e.id},null,8,["label","value"]))),64))])),_:1},8,["modelValue"])])),_:1}),j(i,null,{default:h((()=>[j(p,{type:"primary",onClick:t[5]||(t[5]=e=>(async e=>{e&&await e.validate((e=>{r.value=!0,e?void 0!==n.query.id?R(Q).then((e=>M.success(e.msg))).catch((e=>M.error(e.msg))).finally((()=>{r.value=!1,W()})):K(Q).then((e=>M.success(e.msg))).catch((e=>M.error(e.msg))).finally((()=>{r.value=!1,a.value.resetFields()})):M.error("提交失败，请把数据补充完整"),r.value=!1}))})(a.value))},{default:h((()=>[V(" 提交 ")])),_:1}),j(p,{onClick:t[6]||(t[6]=e=>{var t;(t=a.value)&&t.resetFields()})},{default:h((()=>[V(" 重置 ")])),_:1}),j(p,{type:"success",onClick:t[7]||(t[7]=e=>s.value=!0)},{default:h((()=>[V(" 预览 ")])),_:1})])),_:1})])),_:1},8,["model","rules","size"])])),_:1})),[[Z,r.value]]),j(X,{modelValue:s.value,"onUpdate:modelValue":t[8]||(t[8]=e=>s.value=e),"destroy-on-close":"",width:"70%",title:"公告预览"},{default:h((()=>[j($,{height:"400px"},{default:h((()=>{var e;return[_("h2",se,E(null==Q?void 0:Q.title),1),_("h4",ue,[de,V(),_("span",ce,E(null==(e=C(u).userInfo)?void 0:e.username),1),me,V(E(C(D)(new Date,"YYYY-MM-DD HH:mm:ss").value)+" ",1),pe,V(),j(N,{status:Q.type,"status-list":d},null,8,["status"])]),j(J,{"border-style":"dotted"},{default:h((()=>[V(" 正文 ")])),_:1}),_("section",{class:"flex flex-col justify-center items-center",innerHTML:null==Q?void 0:Q.content},null,8,fe)]})),_:1})])),_:1},8,["modelValue"])])}}});export{ge as default};
