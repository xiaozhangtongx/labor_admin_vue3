import{R as e,d as t,t as n,r as o,a2 as a,o as l,S as r,bl as i,bm as s,U as u,bn as d,a_ as c,ad as m,ac as p,Q as f,a as g,c as v,D as y,l as b,w as h,C as j,k as _,f as C,H as S,W as w,ah as x,a4 as V,q as E,aM as M,an as D}from"./index-7b11e248.js";import{v as k}from"./el-loading-e5ab3d73.js";import{E as I}from"./el-dialog-5e6def37.js";import"./el-overlay-2726d409.js";import{E as U}from"./el-scrollbar-b2ea29b0.js";import{E as A}from"./el-divider-945e9c3d.js";import{_ as L}from"./index.vue_vue_type_script_setup_true_lang-fdbb1041.js";import{E as O}from"./el-card-9aff402c.js";import{a as P,E as z}from"./el-form-item-c47d647a.js";import{E as B}from"./el-button-a9a247f8.js";/* empty css                 */import"./el-tag-d43f7158.js";import{E as F,a as H}from"./el-select-6c18f47a.js";import"./el-popper-b088496a.js";import{g as q,e as R,a as K}from"./index-a6043a12.js";import{b as N}from"./utils-3f53292a.js";import{E as G}from"./index-26c376cb.js";import"./focus-trap-33e167f5.js";import"./event-22bc0892.js";import"./vnode-17b2c6a8.js";import"./error-c58402b8.js";import"./scroll-bcd1b381.js";import"./use-form-common-props-87a080ba.js";import"./strings-de089556.js";import"./isEqual-75d0bc67.js";import"./debounce-42218d7a.js";import"./index-a73a9660.js";import"./validator-fcb3493b.js";import"./index-42cd8a53.js";var T,Y=["onActivate","onAddUndo","onBeforeAddUndo","onBeforeExecCommand","onBeforeGetContent","onBeforeRenderUI","onBeforeSetContent","onBeforePaste","onBlur","onChange","onClearUndos","onClick","onContextMenu","onCopy","onCut","onDblclick","onDeactivate","onDirty","onDrag","onDragDrop","onDragEnd","onDragGesture","onDragOver","onDrop","onExecCommand","onFocus","onFocusIn","onFocusOut","onGetContent","onHide","onInit","onKeyDown","onKeyPress","onKeyUp","onLoadContent","onMouseDown","onMouseEnter","onMouseLeave","onMouseMove","onMouseOut","onMouseOver","onMouseUp","onNodeChange","onObjectResizeStart","onObjectResized","onObjectSelected","onPaste","onPostProcess","onPostRender","onPreProcess","onProgressState","onRedo","onRemove","onReset","onSaveContent","onSelectionChange","onSetAttrib","onSetContent","onShow","onSubmit","onUndo","onVisualAid"],J=function(e){return-1!==Y.map((function(e){return e.toLowerCase()})).indexOf(e.toLowerCase())},Q=function(t,n,o,a,l,r){a.setContent(r()),o.attrs["onUpdate:modelValue"]&&function(t,n,o,a){var l=t.modelEvents?t.modelEvents:null,r=Array.isArray(l)?l.join(" "):l;e(a,(function(e,n){o&&"string"==typeof e&&e!==n&&e!==o.getContent({format:t.outputFormat})&&o.setContent(e)})),o.on(r||"change input undo redo",(function(){n.emit("update:modelValue",o.getContent({format:t.outputFormat}))}))}(n,o,a,l),function(e,t,n){Object.keys(t).filter(J).forEach((function(o){var a=t[o];"function"==typeof a&&("onInit"===o?a(e,n):n.on(o.substring(2),(function(e){return a(e,n)})))}))}(t,o.attrs,a)},W=0,Z=function(e){var t=Date.now();return e+"_"+Math.floor(1e9*Math.random())+ ++W+String(t)},$=function(e){return void 0===e||""===e?[]:Array.isArray(e)?e:e.split(" ")},X=function(){return{listeners:[],scriptId:Z("tiny-script"),scriptLoaded:!1}},ee=(T=X(),{load:function(e,t,n){T.scriptLoaded?n():(T.listeners.push(n),e.getElementById(T.scriptId)||function(e,t,n,o){var a=t.createElement("script");a.referrerPolicy="origin",a.type="application/javascript",a.id=e,a.src=n;var l=function(){a.removeEventListener("load",l),o()};a.addEventListener("load",l),t.head&&t.head.appendChild(a)}(T.scriptId,e,t,(function(){T.listeners.forEach((function(e){return e()})),T.scriptLoaded=!0})))},reinitialize:function(){T=X()}}),te=function(){var e="undefined"!=typeof window?window:global;return e&&e.tinymce?e.tinymce:null},ne={apiKey:String,cloudChannel:String,id:String,init:Object,initialValue:String,inline:Boolean,modelEvents:[String,Array],plugins:[String,Array],tagName:String,toolbar:[String,Array],modelValue:String,disabled:Boolean,tinymceScriptSrc:String,outputFormat:{type:String,validator:function(e){return"html"===e||"text"===e}}},oe=globalThis&&globalThis.__assign||function(){return oe=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},oe.apply(this,arguments)},ae=t({props:ne,setup:function(t,d){var c=t.init?oe({},t.init):{},m=n(t),p=m.disabled,f=m.modelValue,g=m.tagName,v=o(null),y=null,b=t.id||Z("tiny-vue"),h=t.init&&t.init.inline||t.inline,j=!!d.attrs["onUpdate:modelValue"],_=!0,C=t.initialValue?t.initialValue:"",S="",w=function(){var e,n,o,a=(e=_,j?function(){return(null==f?void 0:f.value)?f.value:""}:function(){return e?C:S}),l=oe(oe({},c),{readonly:t.disabled,target:v.value,plugins:(n=c.plugins,o=t.plugins,$(n).concat($(o))),toolbar:t.toolbar||c.toolbar,inline:h,setup:function(e){y=e,e.on("init",(function(n){return Q(n,t,d,e,f,a)})),"function"==typeof c.setup&&c.setup(e)}});(function(e){return null!==e&&"textarea"===e.tagName.toLowerCase()})(v.value)&&(v.value.style.visibility=""),te().init(l),_=!1};e(p,(function(e){var t;null!==y&&("function"==typeof(null===(t=y.mode)||void 0===t?void 0:t.set)?y.mode.set(e?"readonly":"design"):y.setMode(e?"readonly":"design"))})),e(g,(function(e){var t;j||(S=y.getContent()),null===(t=te())||void 0===t||t.remove(y),a((function(){return w()}))})),l((function(){if(null!==te())w();else if(v.value&&v.value.ownerDocument){var e=t.cloudChannel?t.cloudChannel:"6",n=t.apiKey?t.apiKey:"no-api-key",o=null==t.tinymceScriptSrc?"https://cdn.tiny.cloud/1/".concat(n,"/tinymce/").concat(e,"/tinymce.min.js"):t.tinymceScriptSrc;ee.load(v.value.ownerDocument,o,w)}})),r((function(){null!==te()&&te().remove(y)})),h||(i((function(){_||w()})),s((function(){var e;j||(S=y.getContent()),null===(e=te())||void 0===e||e.remove(y)})));return d.expose({rerender:function(e){var t;S=y.getContent(),null===(t=te())||void 0===t||t.remove(y),c=oe(oe({},c),e),a((function(){return w()}))},getEditor:function(){return y}}),function(){return h?function(e,t,n,o){return e(o||"div",{id:t,ref:n})}(u,b,v,t.tagName):u("textarea",{id:b,visibility:"hidden",ref:v})}}});const le=e=>{if(e&&Array.isArray(e)&&e.length>0){const t=d().roles,n=e;return t.some((e=>n.includes(e)))}return console.error("need roles! Like v-permission=\"['admin','editor']\""),!1};const re={class:"app-container"},ie={class:"w-1920px"},se={class:"text-center"},ue={class:"text-center"},de=_("strong",null,"发布者：",-1),ce={class:"text-blue-400"},me=_("strong",{class:"ml-30px"},"发布时间：",-1),pe=_("strong",{class:"ml-30px"},"类型：",-1),fe=["innerHTML"],ge=t({__name:"index",setup(e){var t;const n=m(),a=o(),r=o("default"),i=o(!1),s=o(!1),u=p(),d=[{id:0,value:"安全公告",type:""},{id:1,value:"学习公告",type:"success"},{id:2,value:"考试公告",type:"danger"}],T=o({plugins:"lists link image table code help wordcount a11ychecker",language_url:"tinymce/langs/zh-Hans.js",language:"zh-Hans",toolbar:"undo redo | styleselect | bold italic | link image a11ycheck | formatselect |  alignleft aligncenter alignright | bullist numlist outdent indent | help",branding:!1,elementpath:!1,automatic_uploads:!0,images_reuse_filename:!0,plugin_preview_width:375,paste_data_images:!0,images_upload_handler:e=>new Promise(((t,n)=>{const o=e.blob().type,a="image/jpeg"===o||"image/png"===o||"image/GIF"===o||"image/jpg"===o||"image/BMP"===o;e.blob().size/1024/1024>5?D.warning("上传失败，图片大小请控制在 5M 以内"):a?N(e.blob()).then((e=>{var o;(o=[e],c({url:"sys-upload/images",method:"post",data:o})).then((e=>{t(e.data[0])})).catch((e=>{n(e)}))})):D.warning("图片格式错误")})),placeholder:"请输入公告内容",content_style:"body { font-family:Helvetica,Arial,sans-serif; font-size:16px }"}),Y=f({title:[{required:!0,message:"请输入公告信息",trigger:"blur"},{min:3,max:50,message:"字数在3-50内",trigger:"blur"}],content:[{required:!0,message:"请输入公告内容",trigger:"blur"}],type:[{required:!0,message:"请选择公告类型",trigger:"change"}]}),J=f({id:"",title:"",creatorId:null==(t=u.userInfo)?void 0:t.id,deptId:"",teamId:"",type:0,content:""}),Q=()=>{void 0!==n.query.id&&q(n.query.id).then((e=>Object.assign(J,e.data)))};return l((()=>{Q()})),(e,t)=>{const o=G,l=P,c=F,m=H,p=B,f=z,q=O,N=L,W=A,Z=U,$=I,X=k;return g(),v("div",re,[y((g(),b(q,null,{default:h((()=>[j(f,{ref_key:"noticeFormRef",ref:a,"label-position":"left",model:J,rules:Y,"label-width":"130px",class:"demo-noticeForm",size:r.value,"status-icon":""},{default:h((()=>[j(l,{label:"公告标题",prop:"title"},{default:h((()=>[j(o,{modelValue:J.title,"onUpdate:modelValue":t[0]||(t[0]=e=>J.title=e)},null,8,["modelValue"])])),_:1}),j(l,{label:"公告内容",prop:"content"},{default:h((()=>[_("div",ie,[j(C(ae),{modelValue:J.content,"onUpdate:modelValue":t[1]||(t[1]=e=>J.content=e),"api-key":"u7329yvue4st3dqwrb26xf5pcbw9oma45cp1p9lzev0b4oal",init:T.value},null,8,["modelValue","init"])])])),_:1}),C(le)(["admin","pm","safety"])?(g(),b(l,{key:0,label:"接收部门"},{default:h((()=>[j(o,{modelValue:J.deptId,"onUpdate:modelValue":t[2]||(t[2]=e=>J.deptId=e)},null,8,["modelValue"])])),_:1})):S("",!0),C(le)(["admin","pm","leader","safety"])?(g(),b(l,{key:1,label:"接收小组"},{default:h((()=>[j(o,{modelValue:J.teamId,"onUpdate:modelValue":t[3]||(t[3]=e=>J.teamId=e)},null,8,["modelValue"])])),_:1})):S("",!0),j(l,{label:"公告类型",prop:"type"},{default:h((()=>[j(m,{modelValue:J.type,"onUpdate:modelValue":t[4]||(t[4]=e=>J.type=e),clearable:"",placeholder:"请选择公告类型"},{default:h((()=>[(g(),v(w,null,x(d,(e=>j(c,{key:e.id,label:e.value,value:e.id},null,8,["label","value"]))),64))])),_:1},8,["modelValue"])])),_:1}),j(l,null,{default:h((()=>[j(p,{type:"primary",onClick:t[5]||(t[5]=e=>(async e=>{e&&await e.validate((e=>{i.value=!0,e?void 0!==n.query.id?R(J).then((e=>D.success(e.msg))).catch((e=>D.error(e.msg))).finally((()=>{i.value=!1,Q()})):K(J).then((e=>D.success(e.msg))).catch((e=>D.error(e.msg))).finally((()=>{i.value=!1,a.value.resetFields()})):D.error("提交失败，请把数据补充完整"),i.value=!1}))})(a.value))},{default:h((()=>[V(" 提交 ")])),_:1}),j(p,{onClick:t[6]||(t[6]=e=>{var t;(t=a.value)&&t.resetFields()})},{default:h((()=>[V(" 重置 ")])),_:1}),j(p,{type:"success",onClick:t[7]||(t[7]=e=>s.value=!0)},{default:h((()=>[V(" 预览 ")])),_:1})])),_:1})])),_:1},8,["model","rules","size"])])),_:1})),[[X,i.value]]),j($,{modelValue:s.value,"onUpdate:modelValue":t[8]||(t[8]=e=>s.value=e),"destroy-on-close":"",width:"70%",title:"公告预览"},{default:h((()=>[j(Z,{height:"400px"},{default:h((()=>{var e;return[_("h2",se,E(null==J?void 0:J.title),1),_("h4",ue,[de,V(),_("span",ce,E(null==(e=C(u).userInfo)?void 0:e.username),1),me,V(E(C(M)(new Date,"YYYY-MM-DD HH:mm:ss").value)+" ",1),pe,V(),j(N,{status:J.type,"status-list":d},null,8,["status"])]),j(W,{"border-style":"dotted"},{default:h((()=>[V(" 正文 ")])),_:1}),_("section",{class:"flex flex-col justify-center items-center",innerHTML:null==J?void 0:J.content},null,8,fe)]})),_:1})])),_:1},8,["modelValue"])])}}});export{ge as default};
