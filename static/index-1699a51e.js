import{bo as e,I as t,z as l,bT as a,d as r,r as o,V as n,o as s,a6 as i,ax as u,H as d,c as m,e as c,w as p,K as f,$ as v,ar as g,m as h,l as y}from"./index-e68d8f93.js";import{d as w,E as x,f as b,e as k}from"./el-dialog-e7b228da.js";import"./el-overlay-97c650ce.js";import{b as C,E as _}from"./el-form-item-30fec0aa.js";/* empty css                    */import{E as R}from"./el-button-63854fd4.js";import{E as P}from"./index-23f22c8e.js";import{b as j}from"./index-c065d604.js";import"./focus-trap-8a06a6bb.js";import"./index-77e7e7e3.js";import"./scroll-40ffed28.js";import"./index-880dc49b.js";const V={default:({row:a})=>{const r=e(a.roles);if(0===r.length)return[t("span",{class:"el-tag el-tag--warning el-tag--plain"},[l("劳工")])];return r.map((e=>{const l="admin"===e.roleCode?"":"warning";return t("span",{class:`el-tag el-tag--${l} el-tag--plain`},[e.roleName])}))}},$={default:({row:e,column:l})=>{const a=e[l.field],r=[{id:0,type:"info",value:"不在线"},{id:1,type:"success",value:"在线"},{id:3,type:"primary",value:"已冻结"}],o=r[a].type,n=r[a].value;return[t("span",{class:`el-tag el-tag--${o} el-tag--plain`},[n])]}},E={default:({row:e,column:l})=>{const a=e[l.field];return[t(P,{src:a},null)]}};function N(e){return a({url:`sys-user/delete/${e}`,method:"delete"})}const S={class:"app-container"},T=y("span",{class:"i-ph-pencil-line-light mr-1"},null,-1),U=y("span",{class:"i-carbon-user-role mr-1"},null,-1),D=y("span",{class:"i-material-symbols-delete-outline-rounded mr-1"},null,-1),M=y("span",{class:"i-material-symbols-lock-reset mr-1"},null,-1),q=r({name:"VxeTable"}),z=r({...q,setup(e){const r=o(),y=o(!1),P=o(!1),q=n({roleList:[]});s((()=>{(async e=>{y.value=!0;const t={roleName:e},{data:l}=await j(t);y.value=!1,r.value=[...l]})("")}));const z=o(),O=o(),I=o(),L=n({title:"",showClose:!0,escClosable:!0,maskClosable:!0,beforeHideMethod:()=>{var e;return null==(e=O.value)||e.clearValidate(),Promise.resolve()}}),H=n({loading:!0,border:!0,autoResize:!0,showHeaderOverflow:!0,showOverflow:!0,keepSource:!0,columnConfig:{resizable:!0},pagerConfig:{align:"right"},printConfig:{columns:[{field:"username"},{field:"phoneNum"},{field:"roles"},{field:"avatar"}]},formConfig:{items:[{field:"username",itemRender:{name:"$input",props:{placeholder:"请输入用户名",clearable:!0}}},{itemRender:{name:"$buttons",children:[{props:{type:"submit",content:"查询",status:"primary"}},{props:{type:"reset",content:"重置"}}]}}]},toolbarConfig:{refresh:!0,custom:!0,export:!0,print:!0,zoom:!0,slots:{buttons:"toolbar-btns"}},customConfig:{checkMethod:({column:e})=>!["username"].includes(e.field)},exportConfig:{modes:["current","selected","all"]},columns:[{type:"checkbox",width:"50px"},{field:"avatar",title:"头像",width:"80px",slots:E},{field:"username",title:"用户名"},{field:"roles",title:"角色",slots:V},{field:"phoneNum",title:"手机号"},{field:"createTime",title:"创建时间"},{field:"status",width:"80px",title:"状态",slots:$},{title:"操作",width:"200px",fixed:"right",showOverflow:!1,slots:{default:"row-operate"}}],proxyConfig:{seq:!0,form:!0,props:{total:"total"},ajax:{query:({page:e,form:t})=>(H.loading=!0,F.clearTable(),new Promise((l=>{let r=0,o=[];const n=e=>{if(e&&e.data){const t=e.data;Number.isInteger(t.total)&&(r=t.total),Array.isArray(t.records)&&(o=t.records)}H.loading=!1,l({total:r,result:o})};(function(e){return a({url:"sys-user/list",method:"get",params:e})})({username:t.username||"",phone:t.phone||void 0,size:e.pageSize,current:e.currentPage}).then(n).catch(n)})))}}}),B=n({span:24,titleWidth:"100px",loading:!1,titleColon:!1,data:{id:"",username:"",phoneNum:"",password:"",avatar:""},items:[{field:"username",title:"用户名",itemRender:{name:"$input",props:{placeholder:"请输入用户名"}}},{field:"phoneNum",title:"手机号",itemRender:{name:"$input",props:{placeholder:"请输入手机号"}}},{field:"password",title:"密码",itemRender:{name:"$input",props:{placeholder:"请输入密码"}}},{field:"avatar",title:"头像链接",itemRender:{name:"$input",props:{placeholder:"请输入头像链接"}}},{align:"right",itemRender:{name:"$buttons",children:[{props:{content:"取消"},events:{click:()=>{var e;return null==(e=I.value)?void 0:e.close()}}},{props:{type:"submit",content:"确定",status:"primary"},events:{click:()=>F.onSubmitForm()}}]}}],rules:{username:[{required:!0,validator:({itemValue:e})=>e?e.trim()?void 0:new Error("空格无效"):new Error("请输入用户名")}],phoneNum:[{required:!0,validator:({itemValue:e})=>e?e.trim()?void 0:new Error("空格无效"):new Error("请输入手机号码")}],password:[{required:!0,validator:({itemValue:e})=>e?e.trim()?void 0:new Error("空格无效"):new Error("请输入密码")}]}}),F=n({isUpdate:!0,commitQuery:()=>{var e;return null==(e=z.value)?void 0:e.commitProxy("query")},clearTable:()=>{var e;return null==(e=z.value)?void 0:e.reloadData([])},onShowModal:e=>{var t,l,a,r,o;e?(F.isUpdate=!0,L.title="修改用户",B.data.username=e.username,B.data.phoneNum=e.phoneNum,B.data.avatar=e.avatar):(F.isUpdate=!1,L.title="新增用户"),B.items&&((null==(l=null==(t=B.items[0])?void 0:t.itemRender)?void 0:l.props)&&(B.items[0].itemRender.props.disabled=F.isUpdate),(null==(r=null==(a=B.items[2])?void 0:a.itemRender)?void 0:r.props)&&(B.items[2].itemRender.props.disabled=F.isUpdate)),null==(o=I.value)||o.open(),i((()=>{var e,t;!F.isUpdate&&(null==(e=O.value)||e.reset()),null==(t=O.value)||t.clearValidate()}))},onSubmitForm:()=>{var e;B.loading||null==(e=O.value)||e.validate((e=>{if(e)return;B.loading=!0;const t=e=>{var t;B.loading=!1,200===e.code&&(null==(t=I.value)||t.close(),u.success("操作成功"),!F.isUpdate&&F.afterInsert(),F.commitQuery())};var l;F.isUpdate?setTimeout((()=>t()),1e3):(l=B.data,a({url:"sys-user/add",method:"post",data:l})).then((e=>t(e))).catch((e=>t(e))),B.data={}}))},afterInsert:()=>{var e,t;const l=null==(t=null==(e=z.value)?void 0:e.getProxyInfo())?void 0:t.pager;if(l){l.currentPage*l.pageSize===l.total&&++l.currentPage}},onDelete:e=>{const t=`确定 <strong style='color:red;'>删除</strong> 用户 <strong style='color:#409eff;'>${e.username}</strong> ？`;w.confirm(t,"提示",{type:"error",showClose:!0,closeOnClickModal:!0,closeOnPressEscape:!0,cancelButtonText:"取消",confirmButtonText:"确定",dangerouslyUseHTMLString:!0}).then((()=>{N(e.id).then((()=>{u.success("删除成功"),F.afterDelete(),F.commitQuery()})).catch((()=>1))})).catch((()=>1))},onResetPass:e=>{const t=`确定 <strong style='color:red;'>重置</strong> 用户 <strong style='color:#409eff;'>${e.username}</strong> 的密码？`;w.confirm(t,"提示",{type:"warning",showClose:!0,closeOnClickModal:!0,closeOnPressEscape:!0,cancelButtonText:"取消",confirmButtonText:"确定",dangerouslyUseHTMLString:!0}).then((()=>{N(e.id).then((()=>{u.success("密码重置成功"),F.afterDelete(),F.commitQuery()})).catch((()=>1))})).catch((()=>1))},onSetRole:e=>{P.value=!0,q.roleList=e.roles.map((e=>e.roleName))},afterDelete:()=>{var e,t;const l=z.value.getData(),a=null==(t=null==(e=z.value)?void 0:e.getProxyInfo())?void 0:t.pager;a&&a.currentPage>1&&1===l.length&&--a.currentPage},moreFunc:()=>{}});return(e,a)=>{const o=d("vxe-button"),n=R,s=d("vxe-grid"),i=d("vxe-form"),u=d("vxe-modal"),y=x,w=b,j=C,V=_,$=k;return m(),c("div",S,[t(s,f({ref_key:"xGridDom",ref:z},H),{"toolbar-btns":p((()=>[t(o,{status:"primary",icon:"vxe-icon-add",onClick:a[0]||(a[0]=e=>F.onShowModal())},{default:p((()=>[l(" 新增用户 ")])),_:1}),t(o,{status:"danger",icon:"vxe-icon-delete"},{default:p((()=>[l(" 批量删除 ")])),_:1})])),"row-operate":p((({row:e})=>[t(n,{link:"",type:"primary",onClick:t=>F.onShowModal(e)},{default:p((()=>[T,l(" 修改 ")])),_:2},1032,["onClick"]),t(n,{link:"",type:"info",onClick:t=>F.onSetRole(e)},{default:p((()=>[U,l(" 分配角色 ")])),_:2},1032,["onClick"]),t(n,{link:"",type:"danger",onClick:t=>F.onDelete(e)},{default:p((()=>[D,l(" 注销 ")])),_:2},1032,["onClick"]),t(n,{link:"",type:"warning",onClick:t=>F.onResetPass(e)},{default:p((()=>[M,l(" 重置密码 ")])),_:2},1032,["onClick"])])),_:1},16),t(u,f({ref_key:"xModalDom",ref:I},L),{default:p((()=>[t(i,f({ref_key:"xFormDom",ref:O},B),null,16)])),_:1},16),t($,{modelValue:P.value,"onUpdate:modelValue":a[3]||(a[3]=e=>P.value=e),title:"分配角色",width:"600px"},{default:p((()=>[t(V,{model:q},{default:p((()=>[t(j,null,{default:p((()=>[t(w,{modelValue:q.roleList,"onUpdate:modelValue":a[1]||(a[1]=e=>q.roleList=e)},{default:p((()=>[(m(!0),c(v,null,g(r.value,(e=>(m(),h(y,{key:e.id,label:e.roleName},null,8,["label"])))),128))])),_:1},8,["modelValue"])])),_:1}),t(j,null,{default:p((()=>[t(n,{type:"primary"},{default:p((()=>[l(" 确定 ")])),_:1}),t(n,{onClick:a[2]||(a[2]=e=>P.value=!1)},{default:p((()=>[l(" 取消 ")])),_:1})])),_:1})])),_:1},8,["model"])])),_:1},8,["modelValue"])])}}});export{z as default};
