import{o as e,aS as t,S as n,K as o,r as s,d as r,p as a,R as u,f as c,_ as d,a2 as i,V as l,e as f}from"./index-a195405d.js";function p(e){return null==e}class v extends Error{constructor(e){super(e),this.name="ElementPlusError"}}function m(e,t){throw new v(`[${e}] ${t}`)}function E(e,t){}const w="update:modelValue",y="change",h="input";let L=[];const T=e=>{const t=e;t.key===o.esc&&L.forEach((e=>e(t)))},b="focus-trap.focus-after-trapped",g="focus-trap.focus-after-released",k={cancelable:!0,bubbles:!1},R={cancelable:!0,bubbles:!1},F="focusAfterTrapped",S="focusAfterReleased",K=Symbol("elFocusTrap"),P=s(),N=s(0),I=s(0);let C=0;const _=e=>{const t=[],n=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:e=>{const t="INPUT"===e.tagName&&"hidden"===e.type;return e.disabled||e.hidden||t?NodeFilter.FILTER_SKIP:e.tabIndex>=0||e===document.activeElement?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;n.nextNode();)t.push(n.currentNode);return t},x=(e,t)=>{for(const n of e)if(!A(n,t))return n},A=(e,t)=>{if("hidden"===getComputedStyle(e).visibility)return!0;for(;e;){if(t&&e===t)return!1;if("none"===getComputedStyle(e).display)return!0;e=e.parentElement}return!1},O=(e,t)=>{if(e&&e.focus){const n=document.activeElement;e.focus({preventScroll:!0}),I.value=window.performance.now(),e!==n&&(e=>e instanceof HTMLInputElement&&"select"in e)(e)&&t&&e.select()}};function j(e,t){const n=[...e],o=e.indexOf(t);return-1!==o&&n.splice(o,1),n}const D=(()=>{let e=[];return{push:t=>{const n=e[0];n&&t!==n&&n.pause(),e=j(e,t),e.unshift(t)},remove:t=>{var n,o;e=j(e,t),null==(o=null==(n=e[0])?void 0:n.resume)||o.call(n)}}})(),U=()=>{P.value="pointer",N.value=window.performance.now()},$=()=>{P.value="keyboard",N.value=window.performance.now()},q=e=>new CustomEvent("focus-trap.focusout-prevented",{...R,detail:e});var B=d(r({name:"ElFocusTrap",inheritAttrs:!1,props:{loop:Boolean,trapped:Boolean,focusTrapEl:Object,focusStartEl:{type:[Object,String],default:"first"}},emits:[F,S,"focusin","focusout","focusout-prevented","release-requested"],setup(r,{emit:d}){const f=s();let v,m;const{focusReason:E}=(e((()=>{0===C&&(document.addEventListener("mousedown",U),document.addEventListener("touchstart",U),document.addEventListener("keydown",$)),C++})),n((()=>{C--,C<=0&&(document.removeEventListener("mousedown",U),document.removeEventListener("touchstart",U),document.removeEventListener("keydown",$))})),{focusReason:P,lastUserFocusTimestamp:N,lastAutomatedFocusTimestamp:I});var w;w=e=>{r.trapped&&!y.paused&&d("release-requested",e)},e((()=>{0===L.length&&document.addEventListener("keydown",T),t&&L.push(w)})),n((()=>{L=L.filter((e=>e!==w)),0===L.length&&t&&document.removeEventListener("keydown",T)}));const y={paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}},h=e=>{if(!r.loop&&!r.trapped)return;if(y.paused)return;const{key:t,altKey:n,ctrlKey:s,metaKey:a,currentTarget:u,shiftKey:c}=e,{loop:i}=r,l=t===o.tab&&!n&&!s&&!a,f=document.activeElement;if(l&&f){const t=u,[n,o]=(e=>{const t=_(e);return[x(t,e),x(t.reverse(),e)]})(t);if(n&&o)if(c||f!==o){if(c&&[n,t].includes(f)){const t=q({focusReason:E.value});d("focusout-prevented",t),t.defaultPrevented||(e.preventDefault(),i&&O(o,!0))}}else{const t=q({focusReason:E.value});d("focusout-prevented",t),t.defaultPrevented||(e.preventDefault(),i&&O(n,!0))}else if(f===t){const t=q({focusReason:E.value});d("focusout-prevented",t),t.defaultPrevented||e.preventDefault()}}};a(K,{focusTrapRef:f,onKeydown:h}),u((()=>r.focusTrapEl),(e=>{e&&(f.value=e)}),{immediate:!0}),u([f],(([e],[t])=>{e&&(e.addEventListener("keydown",h),e.addEventListener("focusin",j),e.addEventListener("focusout",B)),t&&(t.removeEventListener("keydown",h),t.removeEventListener("focusin",j),t.removeEventListener("focusout",B))}));const R=e=>{d(F,e)},A=e=>d(S,e),j=e=>{const t=c(f);if(!t)return;const n=e.target,o=e.relatedTarget,s=n&&t.contains(n);if(!r.trapped){o&&t.contains(o)||(v=o)}s&&d("focusin",e),y.paused||r.trapped&&(s?m=n:O(m,!0))},B=e=>{const t=c(f);if(!y.paused&&t)if(r.trapped){const n=e.relatedTarget;p(n)||t.contains(n)||setTimeout((()=>{if(!y.paused&&r.trapped){const e=q({focusReason:E.value});d("focusout-prevented",e),e.defaultPrevented||O(m,!0)}}),0)}else{const n=e.target;n&&t.contains(n)||d("focusout",e)}};async function H(){await i();const e=c(f);if(e){D.push(y);const t=e.contains(document.activeElement)?v:document.activeElement;v=t;if(!e.contains(t)){const n=new Event(b,k);e.addEventListener(b,R),e.dispatchEvent(n),n.defaultPrevented||i((()=>{let n=r.focusStartEl;l(n)||(O(n),document.activeElement!==n&&(n="first")),"first"===n&&((e,t=!1)=>{const n=document.activeElement;for(const o of e)if(O(o,t),document.activeElement!==n)return})(_(e),!0),document.activeElement!==t&&"container"!==n||O(e)}))}}}function M(){const e=c(f);if(e){e.removeEventListener(b,R);const t=new CustomEvent(g,{...k,detail:{focusReason:E.value}});e.addEventListener(g,A),e.dispatchEvent(t),t.defaultPrevented||"keyboard"!=E.value&&N.value>I.value&&!e.contains(document.activeElement)||O(null!=v?v:document.body),e.removeEventListener(g,R),D.remove(y)}}return e((()=>{r.trapped&&H(),u((()=>r.trapped),(e=>{e?H():M()}))})),n((()=>{r.trapped&&M()})),{onKeydown:h}}}),[["render",function(e,t,n,o,s,r){return f(e.$slots,"default",{handleKeydown:e.onKeydown})}],["__file","/home/runner/work/element-plus/element-plus/packages/components/focus-trap/src/focus-trap.vue"]]);export{y as C,B as E,K as F,h as I,w as U,E as d,p as i,m as t};
