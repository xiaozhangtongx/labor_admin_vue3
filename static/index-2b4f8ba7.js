import{C as e,d as a,ad as l,ag as t,r,o,Q as s,a2 as n,an as i,B as u,D as d,a as m,c,w as p,a4 as v,q as f,l as g,f as y,F as b,W as h,ah as x,k}from"./index-2b9e942f.js";import{v as w}from"./el-loading-3c10908a.js";/* empty css                 *//* empty css               */import{E as j,a as _}from"./el-select-a4cfa4aa.js";import"./el-scrollbar-a8bdb3de.js";import"./el-popper-b2d759cd.js";import{E as C}from"./el-card-ffa2c3c9.js";import{E as M,a as P}from"./el-descriptions-item-b1e67eab.js";import{E as T}from"./el-button-4ba8563a.js";import{g as D,a as U,d as I,b as E,c as S}from"./index-ee368478.js";import{r as V,g as q}from"./index-2a3e646a.js";import{E as O}from"./index-b50974fd.js";import{E as z}from"./index-910faca8.js";import"./index-32efc5c0.js";import"./event-15d81b97.js";import"./index-d63fe3b9.js";import"./use-form-item-55331cc2.js";import"./strings-77b070ee.js";import"./scroll-92931c15.js";import"./isEqual-456ab519.js";import"./_Uint8Array-fb59223e.js";import"./debounce-8e1f8eac.js";import"./index-17735892.js";import"./validator-6dddb1ee.js";import"./focus-trap-e29a6647.js";import"./index-d57c4075.js";import"./aria-49c72c55.js";import"./index-9dedcc78.js";const B={default:({row:a,column:l})=>{const t=a[l.field],r=[{id:0,type:"info",value:"禁言"},{id:1,type:"success",value:"正常"}],o=r[t].type,s=r[t].value;return[e("span",{class:`el-tag el-tag--${o} el-tag--plain`},[s])]}},H={class:"app-container"},Q=k("span",{class:"i-mingcute-back-line"},null,-1),R=k("h4",null," 小组成员信息 ",-1),$=k("span",{class:"i-material-symbols-delete-outline-rounded mr-1"},null,-1),F=k("span",{class:"i-material-symbols-lock-reset mr-1"},null,-1),N=a({name:"VxeTable"}),L=a({...N,setup(a){const k=l(),N=t(),L=r(),W=r(!1),A=r(null),G=r(!1),J=r(),K=r(),X=async e=>{var a;G.value=!0;const l=s({username:e||(null==(a=K.value)?void 0:a.username)||"",size:20,current:0}),{data:t}=await q(l);G.value=!1,J.value=t.records.map((e=>({id:e.id,label:e.username,value:e})))};o((()=>{X("")}));const Y=r(),Z=r(),ee=r(),ae=s({title:"",showClose:!0,escClosable:!0,maskClosable:!0,beforeHideMethod:()=>{var e;return null==(e=Z.value)||e.clearValidate(),Promise.resolve()}}),le=s({loading:!0,border:!0,autoResize:!0,showHeaderOverflow:!0,showOverflow:!0,keepSource:!0,columnConfig:{resizable:!0},pagerConfig:{align:"right"},formConfig:{items:[{field:"username",slots:{default:"userName_item"}},{itemRender:{name:"$buttons",children:[{props:{type:"submit",content:"查询",status:"primary"}}]}}]},toolbarConfig:{refresh:!0,custom:!0,export:!0,print:!0,zoom:!0,slots:{buttons:"toolbar-btns"}},customConfig:{checkMethod:({column:e})=>!["username"].includes(e.field)},exportConfig:{modes:["current","selected","all"]},columns:[{type:"checkbox",width:"50px"},{field:"teamMember.username",title:"成员名"},{field:"teamMember.phoneNum",title:"手机号"},{field:"createTime",title:"入组时间"},{field:"status",width:"80px",title:"状态",slots:B},{title:"操作",width:"200px",fixed:"right",showOverflow:!1,slots:{default:"row-operate"}}],proxyConfig:{seq:!0,form:!0,props:{total:"total"},ajax:{query:({page:e,form:a})=>(le.loading=!0,re.clearTable(),new Promise((a=>{var l;let t=0,r=[];const o=e=>{if(e&&e.data){const a=e.data;Number.isInteger(a.total)&&(t=a.total),Array.isArray(a.records)&&(r=a.records)}le.loading=!1,a({total:t,result:r})},s={teamId:k.query.id,userId:(null==(l=K.value)?void 0:l.id)||"",size:e.pageSize,current:e.currentPage};D(s).then(o).catch(o)})))}}}),te=s({span:24,titleWidth:"100px",loading:!1,titleColon:!1,data:{id:"",member:null,userId:"",teamId:k.query.id},items:[{title:"小组成员",slots:{default:"member_item"}},{align:"right",itemRender:{name:"$buttons",children:[{props:{content:"取消"},events:{click:()=>{var e;return null==(e=ee.value)?void 0:e.close()}}},{props:{type:"submit",content:"确定",status:"primary"},events:{click:()=>re.onSubmitForm()}}]}}]}),re=s({isUpdate:!0,commitQuery:()=>{var e;return null==(e=Y.value)?void 0:e.commitProxy("query")},clearTable:()=>{var e;return null==(e=Y.value)?void 0:e.reloadData([])},onShowModal:()=>{var e;ae.title="新增组员",null==(e=ee.value)||e.open(),n((()=>{var e,a;!re.isUpdate&&(null==(e=Z.value)||e.reset()),null==(a=Z.value)||a.clearValidate()}))},onSubmitForm:()=>{var e;te.loading||null==(e=Z.value)||e.validate((e=>{if(e)return;te.loading=!0;const a=e=>{var a;te.loading=!1,200===e.code&&(null==(a=ee.value)||a.close(),i.success("操作成功"),!re.isUpdate&&re.afterInsert(),re.commitQuery())};te.data.userId=te.data.member.id,te.data.teamId=k.query.id,U(te.data).then((e=>a(e))).catch((e=>a(e))),te.data={}}))},afterInsert:()=>{var e,a;const l=null==(a=null==(e=Y.value)?void 0:e.getProxyInfo())?void 0:a.pager;if(l){l.currentPage*l.pageSize===l.total&&++l.currentPage}},onDelete:e=>{const a=`确定 <strong style='color:red;'>删除</strong> 组员 <strong style='color:#409eff;'>${e.teamMember.username}</strong> ？`;O.confirm(a,"提示",{type:"error",showClose:!0,closeOnClickModal:!0,closeOnPressEscape:!0,cancelButtonText:"取消",confirmButtonText:"确定",dangerouslyUseHTMLString:!0}).then((()=>{I(e.id).then((()=>{i.success("删除成功"),re.afterDelete(),re.commitQuery()})).catch((()=>1))})).catch((()=>1))},onResetPass:e=>{const a=`确定 <strong style='color:red;'>重置</strong> 组员 <strong style='color:#409eff;'>${e.teamMember.username}</strong> 的密码？`;O.confirm(a,"提示",{type:"warning",showClose:!0,closeOnClickModal:!0,closeOnPressEscape:!0,cancelButtonText:"取消",confirmButtonText:"确定",dangerouslyUseHTMLString:!0}).then((()=>{V(e.teamMember).then((()=>{i.success("密码重置成功"),re.afterDelete(),re.commitQuery()})).catch((()=>1))})).catch((()=>1))},onDeleteUsers:()=>{O.confirm("确定 <strong style='color:red;'>删除</strong> 这些组员吗？","提示",{type:"warning",showClose:!0,closeOnClickModal:!0,closeOnPressEscape:!0,cancelButtonText:"取消",confirmButtonText:"确定",dangerouslyUseHTMLString:!0}).then((()=>{var e;const a=null==(e=Y.value)?void 0:e.getCheckboxRecords().map((e=>e.id));E(a).then((e=>{i.success(e.msg)})).catch((e=>{i.error(e.msg)})).finally((()=>{re.afterDelete(),re.commitQuery()}))})).catch((()=>1))},afterDelete:()=>{var e,a;const l=Y.value.getData(),t=null==(a=null==(e=Y.value)?void 0:e.getProxyInfo())?void 0:a.pager;t&&t.currentPage>1&&1===l.length&&--t.currentPage},moreFunc:()=>{}});return o((()=>{(()=>{const e=k.query.id;void 0===e?N.push("/403"):(W.value=!0,S(e).then((e=>{L.value=e.data,A.value=e.data.leader})).catch((e=>{i.error(e.message)})).finally((()=>{W.value=!1})))})()})),(a,l)=>{const t=M,r=z,o=T,s=P,n=C,i=j,k=_,D=u("vxe-button"),U=u("vxe-grid"),I=u("vxe-form"),E=u("vxe-modal"),S=w;return d((m(),c("div",H,[e(n,{shadow:"never"},{default:p((()=>[e(s,{title:"小组信息",column:3},{default:p((()=>[e(t,{label:"小组名称:"},{default:p((()=>{var e;return[v(f(null==(e=L.value)?void 0:e.teamName),1)]})),_:1}),e(t,{label:"小组职责:"},{default:p((()=>{var e;return[v(f(null==(e=L.value)?void 0:e.des),1)]})),_:1}),e(t,{label:"创建时间:"},{default:p((()=>{var e;return[v(f(null==(e=L.value)?void 0:e.createTime),1)]})),_:1}),e(t,{label:"小组组长:"},{default:p((()=>{var e;return[v(f(null==(e=L.value)?void 0:e.teamLeader.username),1)]})),_:1}),e(t,{label:"小组状态:"},{default:p((()=>{var e;return[0===(null==(e=L.value)?void 0:e.status)?(m(),g(r,{key:0,class:"ml-2",type:"danger"},{default:p((()=>[v(" 停工 ")])),_:1})):(m(),g(r,{key:1,class:"ml-2",type:"success"},{default:p((()=>[v(" 正常 ")])),_:1}))]})),_:1}),e(t,null,{default:p((()=>[e(o,{type:"success",onClick:l[0]||(l[0]=e=>y(N).push("/sys/team"))},{default:p((()=>[Q,v(" 返回上一页 ")])),_:1})])),_:1})])),_:1})])),_:1}),e(n,{shadow:"never",class:"mt-2"},{default:p((()=>[R,e(U,b({ref_key:"xGridDom",ref:Y},le),{userName_item:p((()=>[e(k,{modelValue:K.value,"onUpdate:modelValue":l[1]||(l[1]=e=>K.value=e),"value-key":"id","remote-show-suffix":"",filterable:"",remote:"",clearable:"","reserve-keyword":"",placeholder:"请输入员工的姓名","remote-method":X,loading:G.value},{default:p((()=>[(m(!0),c(h,null,x(J.value,(e=>(m(),g(i,{key:e.id,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue","loading"])])),"toolbar-btns":p((()=>[e(D,{status:"primary",icon:"vxe-icon-add",onClick:l[2]||(l[2]=e=>re.onShowModal())},{default:p((()=>[v(" 新增成员 ")])),_:1}),e(D,{status:"danger",icon:"vxe-icon-delete",onClick:l[3]||(l[3]=e=>re.onDeleteUsers())},{default:p((()=>[v(" 批量删除 ")])),_:1})])),"row-operate":p((({row:a})=>[e(o,{link:"",type:"danger",onClick:e=>re.onDelete(a)},{default:p((()=>[$,v(" 移除 ")])),_:2},1032,["onClick"]),e(o,{link:"",type:"warning",onClick:e=>re.onResetPass(a)},{default:p((()=>[F,v(" 重置密码 ")])),_:2},1032,["onClick"])])),_:1},16),e(E,b({ref_key:"xModalDom",ref:ee},ae),{default:p((()=>[e(I,b({ref_key:"xFormDom",ref:Z},te),{member_item:p((({data:a})=>[e(k,{modelValue:a.member,"onUpdate:modelValue":e=>a.member=e,"value-key":"id","remote-show-suffix":"",filterable:"",remote:"",clearable:"","reserve-keyword":"",placeholder:"请输入组员的姓名","remote-method":X,loading:G.value},{default:p((()=>[(m(!0),c(h,null,x(J.value,(e=>(m(),g(i,{key:e.id,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue","loading"])])),_:1},16)])),_:1},16)])),_:1})])),[[S,W.value]])}}});export{L as default};
