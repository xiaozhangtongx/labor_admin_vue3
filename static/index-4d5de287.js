import{R as e,d as t,t as n,r as o,a2 as a,o as l,S as i,bu as r,bv as s,U as u,bw as d,b5 as c,ad as m,ac as p,Q as f,a as g,c as v,D as y,l as b,w as h,C as j,k as _,f as C,H as w,W as x,ah as S,a4 as V,q as E,b7 as D,an as I}from"./index-6bedee7a.js";import{v as k}from"./el-loading-c3dbe64c.js";import{E as M}from"./el-dialog-3be897ff.js";import"./el-overlay-6a5b9793.js";import{E as U}from"./el-scrollbar-311b8480.js";import{E as A}from"./el-divider-a3b8e20b.js";import{_ as O}from"./index.vue_vue_type_script_setup_true_lang-193ed662.js";import{E as P}from"./el-card-a8a09491.js";import{a as L,E as B}from"./el-form-item-2a4e0d8b.js";import{E as F}from"./el-button-6185c98d.js";/* empty css                 */import"./el-tag-bb50ec24.js";import{E as z,a as q}from"./el-select-64ab83ce.js";import"./el-popper-f3350b80.js";import{g as H,e as R,a as K}from"./index-1584fefc.js";import{E as G}from"./index-1ccd55e8.js";import"./focus-trap-655ad7f2.js";import"./index-989e8f0e.js";import"./scroll-fb79b12b.js";import"./strings-584cf1d9.js";import"./isEqual-d5e7f9b5.js";import"./debounce-a86a547f.js";import"./index-3d245059.js";import"./validator-808a3493.js";import"./index-bbe36fd2.js";var N,T=["onActivate","onAddUndo","onBeforeAddUndo","onBeforeExecCommand","onBeforeGetContent","onBeforeRenderUI","onBeforeSetContent","onBeforePaste","onBlur","onChange","onClearUndos","onClick","onContextMenu","onCopy","onCut","onDblclick","onDeactivate","onDirty","onDrag","onDragDrop","onDragEnd","onDragGesture","onDragOver","onDrop","onExecCommand","onFocus","onFocusIn","onFocusOut","onGetContent","onHide","onInit","onKeyDown","onKeyPress","onKeyUp","onLoadContent","onMouseDown","onMouseEnter","onMouseLeave","onMouseMove","onMouseOut","onMouseOver","onMouseUp","onNodeChange","onObjectResizeStart","onObjectResized","onObjectSelected","onPaste","onPostProcess","onPostRender","onPreProcess","onProgressState","onRedo","onRemove","onReset","onSaveContent","onSelectionChange","onSetAttrib","onSetContent","onShow","onSubmit","onUndo","onVisualAid"],Y=function(e){return-1!==T.map((function(e){return e.toLowerCase()})).indexOf(e.toLowerCase())},Q=function(t,n,o,a,l,i){a.setContent(i()),o.attrs["onUpdate:modelValue"]&&function(t,n,o,a){var l=t.modelEvents?t.modelEvents:null,i=Array.isArray(l)?l.join(" "):l;e(a,(function(e,n){o&&"string"==typeof e&&e!==n&&e!==o.getContent({format:t.outputFormat})&&o.setContent(e)})),o.on(i||"change input undo redo",(function(){n.emit("update:modelValue",o.getContent({format:t.outputFormat}))}))}(n,o,a,l),function(e,t,n){Object.keys(t).filter(Y).forEach((function(o){var a=t[o];"function"==typeof a&&("onInit"===o?a(e,n):n.on(o.substring(2),(function(e){return a(e,n)})))}))}(t,o.attrs,a)},W=0,J=function(e){var t=Date.now();return e+"_"+Math.floor(1e9*Math.random())+ ++W+String(t)},X=function(e){return void 0===e||""===e?[]:Array.isArray(e)?e:e.split(" ")},Z=function(){return{listeners:[],scriptId:J("tiny-script"),scriptLoaded:!1}},$=(N=Z(),{load:function(e,t,n){N.scriptLoaded?n():(N.listeners.push(n),e.getElementById(N.scriptId)||function(e,t,n,o){var a=t.createElement("script");a.referrerPolicy="origin",a.type="application/javascript",a.id=e,a.src=n;var l=function(){a.removeEventListener("load",l),o()};a.addEventListener("load",l),t.head&&t.head.appendChild(a)}(N.scriptId,e,t,(function(){N.listeners.forEach((function(e){return e()})),N.scriptLoaded=!0})))},reinitialize:function(){N=Z()}}),ee=function(){var e="undefined"!=typeof window?window:global;return e&&e.tinymce?e.tinymce:null},te={apiKey:String,cloudChannel:String,id:String,init:Object,initialValue:String,inline:Boolean,modelEvents:[String,Array],plugins:[String,Array],tagName:String,toolbar:[String,Array],modelValue:String,disabled:Boolean,tinymceScriptSrc:String,outputFormat:{type:String,validator:function(e){return"html"===e||"text"===e}}},ne=globalThis&&globalThis.__assign||function(){return ne=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},ne.apply(this,arguments)},oe=t({props:te,setup:function(t,d){var c=t.init?ne({},t.init):{},m=n(t),p=m.disabled,f=m.modelValue,g=m.tagName,v=o(null),y=null,b=t.id||J("tiny-vue"),h=t.init&&t.init.inline||t.inline,j=!!d.attrs["onUpdate:modelValue"],_=!0,C=t.initialValue?t.initialValue:"",w="",x=function(){var e,n,o,a=(e=_,j?function(){return(null==f?void 0:f.value)?f.value:""}:function(){return e?C:w}),l=ne(ne({},c),{readonly:t.disabled,target:v.value,plugins:(n=c.plugins,o=t.plugins,X(n).concat(X(o))),toolbar:t.toolbar||c.toolbar,inline:h,setup:function(e){y=e,e.on("init",(function(n){return Q(n,t,d,e,f,a)})),"function"==typeof c.setup&&c.setup(e)}});(function(e){return null!==e&&"textarea"===e.tagName.toLowerCase()})(v.value)&&(v.value.style.visibility=""),ee().init(l),_=!1};e(p,(function(e){var t;null!==y&&("function"==typeof(null===(t=y.mode)||void 0===t?void 0:t.set)?y.mode.set(e?"readonly":"design"):y.setMode(e?"readonly":"design"))})),e(g,(function(e){var t;j||(w=y.getContent()),null===(t=ee())||void 0===t||t.remove(y),a((function(){return x()}))})),l((function(){if(null!==ee())x();else if(v.value&&v.value.ownerDocument){var e=t.cloudChannel?t.cloudChannel:"6",n=t.apiKey?t.apiKey:"no-api-key",o=null==t.tinymceScriptSrc?"https://cdn.tiny.cloud/1/".concat(n,"/tinymce/").concat(e,"/tinymce.min.js"):t.tinymceScriptSrc;$.load(v.value.ownerDocument,o,x)}})),i((function(){null!==ee()&&ee().remove(y)})),h||(r((function(){_||x()})),s((function(){var e;j||(w=y.getContent()),null===(e=ee())||void 0===e||e.remove(y)})));return d.expose({rerender:function(e){var t;w=y.getContent(),null===(t=ee())||void 0===t||t.remove(y),c=ne(ne({},c),e),a((function(){return x()}))},getEditor:function(){return y}}),function(){return h?function(e,t,n,o){return e(o||"div",{id:t,ref:n})}(u,b,v,t.tagName):u("textarea",{id:b,visibility:"hidden",ref:v})}}});const ae=e=>{if(e&&Array.isArray(e)&&e.length>0){const t=d().roles,n=e;return t.some((e=>n.includes(e)))}return console.error("need roles! Like v-permission=\"['admin','editor']\""),!1};const le={class:"app-container"},ie={class:"w-1920px"},re={class:"text-center"},se={class:"text-center"},ue=_("strong",null,"发布者：",-1),de={class:"text-blue-400"},ce=_("strong",{class:"ml-30px"},"发布时间：",-1),me=_("strong",{class:"ml-30px"},"类型：",-1),pe=["innerHTML"],fe=t({__name:"index",setup(e){var t;const n=m(),a=o(),i=o("default"),r=o(!1),s=o(!1),u=p(),d=[{id:0,value:"安全公告",type:""},{id:1,value:"学习公告",type:"success"},{id:2,value:"考试公告",type:"danger"}],N=o({plugins:"lists link image table code help wordcount a11ychecker",language_url:"tinymce/langs/zh-Hans.js",language:"zh-Hans",toolbar:"undo redo | styleselect | bold italic | link image a11ycheck | formatselect |  alignleft aligncenter alignright | bullist numlist outdent indent | help",branding:!1,elementpath:!1,automatic_uploads:!0,images_reuse_filename:!0,plugin_preview_width:375,paste_data_images:!0,images_upload_handler:e=>new Promise(((t,n)=>{const o=e.blob().type,a="image/jpeg"===o||"image/png"===o||"image/GIF"===o||"image/jpg"===o||"image/BMP"===o;if(e.blob().size/1024/1024>5)I.warning("上传失败，图片大小请控制在 5M 以内");else if(a){const o=[e.base64()];(l=o,c({url:"sys-upload/images",method:"post",data:l})).then((e=>{t(e.data[0])})).catch((e=>{n(e)}))}else I.warning("图片格式错误");var l})),placeholder:"请输入公告内容",content_style:"body { font-family:Helvetica,Arial,sans-serif; font-size:16px }"}),T=f({title:[{required:!0,message:"请输入公告信息",trigger:"blur"},{min:3,max:50,message:"字数在3-50内",trigger:"blur"}],content:[{required:!0,message:"请输入公告内容",trigger:"blur"}],type:[{required:!0,message:"请选择公告类型",trigger:"change"}]}),Y=f({id:"",title:"",creatorId:null==(t=u.userInfo)?void 0:t.id,deptId:"",teamId:"",type:0,content:""}),Q=()=>{void 0!==n.query.id&&H(n.query.id).then((e=>Object.assign(Y,e.data)))};return l((()=>{Q()})),(e,t)=>{const o=G,l=L,c=z,m=q,p=F,f=B,H=P,W=O,J=A,X=U,Z=M,$=k;return g(),v("div",le,[y((g(),b(H,null,{default:h((()=>[j(f,{ref_key:"noticeFormRef",ref:a,"label-position":"left",model:Y,rules:T,"label-width":"130px",class:"demo-noticeForm",size:i.value,"status-icon":""},{default:h((()=>[j(l,{label:"公告标题",prop:"title"},{default:h((()=>[j(o,{modelValue:Y.title,"onUpdate:modelValue":t[0]||(t[0]=e=>Y.title=e)},null,8,["modelValue"])])),_:1}),j(l,{label:"公告内容",prop:"content"},{default:h((()=>[_("div",ie,[j(C(oe),{modelValue:Y.content,"onUpdate:modelValue":t[1]||(t[1]=e=>Y.content=e),"api-key":"u7329yvue4st3dqwrb26xf5pcbw9oma45cp1p9lzev0b4oal",init:N.value},null,8,["modelValue","init"])])])),_:1}),C(ae)(["admin","pm","safety"])?(g(),b(l,{key:0,label:"接收部门"},{default:h((()=>[j(o,{modelValue:Y.deptId,"onUpdate:modelValue":t[2]||(t[2]=e=>Y.deptId=e)},null,8,["modelValue"])])),_:1})):w("",!0),C(ae)(["admin","pm","leader","safety"])?(g(),b(l,{key:1,label:"接收小组"},{default:h((()=>[j(o,{modelValue:Y.teamId,"onUpdate:modelValue":t[3]||(t[3]=e=>Y.teamId=e)},null,8,["modelValue"])])),_:1})):w("",!0),j(l,{label:"公告类型",prop:"type"},{default:h((()=>[j(m,{modelValue:Y.type,"onUpdate:modelValue":t[4]||(t[4]=e=>Y.type=e),clearable:"",placeholder:"请选择公告类型"},{default:h((()=>[(g(),v(x,null,S(d,(e=>j(c,{key:e.id,label:e.value,value:e.id},null,8,["label","value"]))),64))])),_:1},8,["modelValue"])])),_:1}),j(l,null,{default:h((()=>[j(p,{type:"primary",onClick:t[5]||(t[5]=e=>(async e=>{e&&await e.validate((e=>{r.value=!0,e?void 0!==n.query.id?R(Y).then((e=>I.success(e.msg))).catch((e=>I.error(e.msg))).finally((()=>{r.value=!1,Q()})):K(Y).then((e=>I.success(e.msg))).catch((e=>I.error(e.msg))).finally((()=>{r.value=!1,a.value.resetFields()})):I.error("提交失败，请把数据补充完整"),r.value=!1}))})(a.value))},{default:h((()=>[V(" 提交 ")])),_:1}),j(p,{onClick:t[6]||(t[6]=e=>{var t;(t=a.value)&&t.resetFields()})},{default:h((()=>[V(" 重置 ")])),_:1}),j(p,{type:"success",onClick:t[7]||(t[7]=e=>s.value=!0)},{default:h((()=>[V(" 预览 ")])),_:1})])),_:1})])),_:1},8,["model","rules","size"])])),_:1})),[[$,r.value]]),j(Z,{modelValue:s.value,"onUpdate:modelValue":t[8]||(t[8]=e=>s.value=e),"destroy-on-close":"",width:"70%",title:"公告预览"},{default:h((()=>[j(X,{height:"400px"},{default:h((()=>{var e;return[_("h2",re,E(null==Y?void 0:Y.title),1),_("h4",se,[ue,V(),_("span",de,E(null==(e=C(u).userInfo)?void 0:e.username),1),ce,V(E(C(D)(new Date,"YYYY-MM-DD HH:mm:ss").value)+" ",1),me,V(),j(W,{status:Y.type,"status-list":d},null,8,["status"])]),j(J,{"border-style":"dotted"},{default:h((()=>[V(" 正文 ")])),_:1}),_("section",{class:"flex flex-col justify-center items-center",innerHTML:null==Y?void 0:Y.content},null,8,pe)]})),_:1})])),_:1},8,["modelValue"])])}}});export{fe as default};
