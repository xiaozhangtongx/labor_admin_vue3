import{d as e,ag as a,r as t,Q as l,a2 as r,o,B as i,a as s,c as d,C as n,w as u,a4 as m,F as p,W as c,ah as f,l as v,k as g,an as h}from"./index-2b9e942f.js";/* empty css                 *//* empty css               */import{E as b,a as y}from"./el-select-a4cfa4aa.js";import"./el-scrollbar-a8bdb3de.js";import"./el-popper-b2d759cd.js";import{E as x}from"./el-divider-d5133940.js";import{E as w}from"./el-button-4ba8563a.js";import{c as j,d as k,e as C}from"./index-72956bb8.js";import{g as _}from"./index-2a3e646a.js";import"./index-32efc5c0.js";import"./event-15d81b97.js";import"./index-d63fe3b9.js";import"./use-form-item-55331cc2.js";import"./index-910faca8.js";import"./strings-77b070ee.js";import"./scroll-92931c15.js";import"./isEqual-456ab519.js";import"./_Uint8Array-fb59223e.js";import"./debounce-8e1f8eac.js";import"./index-17735892.js";import"./validator-6dddb1ee.js";import"./focus-trap-e29a6647.js";const N={class:"app-container"},U=g("span",{class:"i-mdi-clipboard-search-outline"},null,-1),q=g("span",{class:"i-ph-pencil-line-light"},null,-1),I=g("span",{class:"i-fluent-people-team-24-filled"},null,-1),S=e({name:"VxeTable"}),V=e({...S,setup(e){const g=a(),S=t(),V=t(),z=t(),E=t(),P=t(),T=t(!1),M=async e=>{var a;T.value=!0;const t=l({username:e||(null==(a=P.value)?void 0:a.username)||"",size:20,current:0}),{data:r}=await _(t);T.value=!1,E.value=r.records.map((e=>({id:e.id,label:e.username,value:e})))},R=l({title:"",showClose:!0,escClosable:!0,maskClosable:!0,beforeHideMethod:()=>{var e;return null==(e=V.value)||e.clearValidate(),Promise.resolve()}}),$=l({loading:!0,border:!0,autoResize:!0,showHeaderOverflow:!0,showOverflow:!0,keepSource:!0,columnConfig:{resizable:!0},pagerConfig:{align:"right"},formConfig:{items:[{field:"deptName",itemRender:{name:"$input",props:{placeholder:"请输入部门名称",clearable:!0}}},{itemRender:{name:"$buttons",children:[{props:{type:"submit",content:"查询",status:"primary"}},{props:{type:"reset",content:"重置"}}]}}]},toolbarConfig:{refresh:!0,custom:!0,export:!0,print:!0,zoom:!0,slots:{buttons:"toolbar-btns"}},customConfig:{checkMethod:({column:e})=>!["username"].includes(e.field)},exportConfig:{modes:["current","selected","all"]},columns:[{type:"seq",title:"序号",width:"50px"},{field:"deptName",title:"部门名"},{field:"des",title:"部门职责"},{field:"createTime",title:"创建时间"},{field:"updateTime",title:"上次更新时间"},{title:"操作",width:"370px",fixed:"right",showOverflow:!1,slots:{default:"row-operate"}}],proxyConfig:{seq:!0,form:!0,props:{total:"total"},ajax:{query:({page:e,form:a})=>($.loading=!0,D.clearTable(),new Promise((t=>{let l=0,r=[];const o=e=>{if(e&&e.data){const a=e.data;Number.isInteger(a.total)&&(l=a.total),Array.isArray(a.records)&&(r=a.records)}$.loading=!1,t({total:l,result:r})},i={deptName:a.deptName||"",size:e.pageSize,current:e.currentPage};j(i).then(o).catch(o)})))}}}),G=l({span:24,titleWidth:"100px",loading:!1,titleColon:!1,data:{id:"",deptName:"",des:"",leader:null,leaderId:""},items:[{field:"deptName",title:"部门名称",itemRender:{name:"$input",props:{placeholder:"请输入部门名"}}},{field:"des",title:"部门职责",itemRender:{name:"$input",props:{placeholder:"请输入部门职责"}}},{field:"leaderId",title:"部门主管",slots:{default:"leader_item"}},{align:"right",itemRender:{name:"$buttons",children:[{props:{content:"取消"},events:{click:()=>{var e;return null==(e=z.value)?void 0:e.close()}}},{props:{type:"submit",content:"确定",status:"primary"},events:{click:()=>D.onSubmitForm()}}]}}],rules:{deptName:[{required:!0,validator:({itemValue:e})=>e?e.trim()?void 0:new Error("空格无效"):new Error("请输入部门名称")}],des:[{required:!0,validator:({itemValue:e})=>e?e.trim()?void 0:new Error("空格无效"):new Error("请输入部门职责")}]}}),D=l({isUpdate:!0,commitQuery:()=>{var e;return null==(e=S.value)?void 0:e.commitProxy("query")},clearTable:()=>{var e;return null==(e=S.value)?void 0:e.reloadData([])},onShowModal:e=>{var a;e?(D.isUpdate=!0,R.title="修改部门",G.data.id=e.id,G.data.deptName=e.deptName,G.data.des=e.des,G.data.leader=e.leader):(D.isUpdate=!1,R.title="新增部门"),null==(a=z.value)||a.open(),r((()=>{var e,a;!D.isUpdate&&(null==(e=V.value)||e.reset()),null==(a=V.value)||a.clearValidate()}))},onSubmitForm:e=>{var a;G.loading||null==(a=V.value)||a.validate((e=>{if(e)return;G.loading=!0;const a=e=>{var a;G.loading=!1,200===e.code&&(null==(a=z.value)||a.close(),h.success("操作成功"),G.data.leader=null,!D.isUpdate&&D.afterInsert(),D.commitQuery())};G.data.leaderId=G.data.leader.id,D.isUpdate?k(G.data).then((e=>a(e))).catch((e=>a(e))):C(G.data).then((e=>a(e))).catch((e=>a(e))),G.data={}}))},onGoInfo:e=>{g.push({path:"/sys/dept/info",query:{id:null==e?void 0:e.id}})},onGoTeam:e=>{g.push({path:"/sys/team",query:{id:null==e?void 0:e.id}})},afterInsert:()=>{var e,a;const t=null==(a=null==(e=S.value)?void 0:e.getProxyInfo())?void 0:a.pager;if(t){t.currentPage*t.pageSize===t.total&&++t.currentPage}}});return o((()=>{M("")})),(e,a)=>{const t=i("vxe-button"),l=w,r=x,o=i("vxe-grid"),g=b,h=y,j=i("vxe-form"),k=i("vxe-modal");return s(),d("div",N,[n(o,p({ref_key:"xGridDom",ref:S},$),{"toolbar-btns":u((()=>[n(t,{status:"primary",icon:"vxe-icon-add",onClick:a[0]||(a[0]=e=>D.onShowModal())},{default:u((()=>[m(" 新增部门 ")])),_:1})])),"row-operate":u((({row:e})=>[n(l,{link:"",type:"primary",onClick:a=>D.onGoInfo(e)},{default:u((()=>[U,m(" 查看详情 ")])),_:2},1032,["onClick"]),n(r,{direction:"vertical"}),n(l,{link:"",type:"warning",onClick:a=>D.onShowModal(e)},{default:u((()=>[q,m(" 信息修改 ")])),_:2},1032,["onClick"]),n(r,{direction:"vertical"}),n(l,{link:"",type:"danger",onClick:a=>D.onGoTeam(e)},{default:u((()=>[I,m(" 下属小组 ")])),_:2},1032,["onClick"])])),_:1},16),n(k,p({ref_key:"xModalDom",ref:z},R),{default:u((()=>[n(j,p({ref_key:"xFormDom",ref:V},G),{leader_item:u((({data:e})=>[n(h,{modelValue:e.leader,"onUpdate:modelValue":a=>e.leader=a,"value-key":"id","remote-show-suffix":"",filterable:"",remote:"",clearable:"","reserve-keyword":"",placeholder:"请输入主管的姓名","remote-method":M,loading:T.value},{default:u((()=>[(s(!0),d(c,null,f(E.value,(e=>(s(),v(g,{key:e.id,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue","loading"])])),_:1},16)])),_:1},16)])}}});export{V as default};
