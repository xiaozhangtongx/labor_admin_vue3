import{d as e,ag as a,ad as t,r,Q as l,a2 as o,o as i,B as d,a as s,c as n,C as m,w as u,f as p,l as c,a4 as v,H as f,F as y,W as g,ah as h,k as b,an as x}from"./index-af1b0f7f.js";/* empty css                 *//* empty css               */import{E as w,a as j}from"./el-select-15637aa0.js";import"./el-scrollbar-122da2af.js";import"./el-popper-93d8741f.js";import{E as k}from"./el-divider-1bd339ed.js";import{E as C}from"./el-button-4c1bfddb.js";import{e as q,u as _,f as I}from"./index-acb24c4e.js";import{g as N}from"./index-44f0e3f2.js";import"./index-b7e1e73a.js";import"./event-15d81b97.js";import"./index-de5a0541.js";import"./use-form-item-c127ca03.js";import"./index-9e5f34e5.js";import"./strings-a26e2dce.js";import"./scroll-9ad6d206.js";import"./isEqual-b39ef673.js";import"./_Uint8Array-e7b42d57.js";import"./debounce-8a611c37.js";import"./index-8024eeb1.js";import"./validator-e168c632.js";import"./focus-trap-1edd113c.js";const V={class:"app-container"},U=b("span",{class:"i-mdi-clipboard-search-outline"},null,-1),E=b("span",{class:"i-ph-pencil-line-light"},null,-1),S=e({name:"VxeTable"}),z=e({...S,setup(e){const b=a(),S=t(),z=r(),P=r(),M=r(),R=r(),T=r(),$=r(!1),D=async e=>{var a;$.value=!0;const t=l({username:e||(null==(a=T.value)?void 0:a.username)||"",size:20,current:0}),{data:r}=await N(t);$.value=!1,R.value=r.records.map((e=>({id:e.id,label:e.username,value:e})))},F=l({title:"",showClose:!0,escClosable:!0,maskClosable:!0,beforeHideMethod:()=>{var e;return null==(e=P.value)||e.clearValidate(),Promise.resolve()}}),H=l({loading:!0,border:!0,autoResize:!0,showHeaderOverflow:!0,showOverflow:!0,keepSource:!0,columnConfig:{resizable:!0},pagerConfig:{align:"right"},formConfig:{items:[{field:"teamName",itemRender:{name:"$input",props:{placeholder:"请输入小组名称",clearable:!0}}},{itemRender:{name:"$buttons",children:[{props:{type:"submit",content:"查询",status:"primary"}},{props:{type:"reset",content:"重置"}}]}}]},toolbarConfig:{refresh:!0,custom:!0,export:!0,print:!0,zoom:!0,slots:{buttons:"toolbar-btns"}},customConfig:{checkMethod:({column:e})=>!["username"].includes(e.field)},exportConfig:{modes:["current","selected","all"]},columns:[{type:"seq",title:"序号",width:"50px"},{field:"teamName",title:"小组名"},{field:"teamLeader.username",title:"小组组长"},{field:"des",title:"小组职责"},{field:"createTime",title:"创建时间"},{field:"updateTime",title:"上次更新时间"},{title:"操作",width:"270px",fixed:"right",showOverflow:!1,slots:{default:"row-operate"}}],proxyConfig:{seq:!0,form:!0,props:{total:"total"},ajax:{query:({page:e,form:a})=>(H.loading=!0,G.clearTable(),new Promise((t=>{let r=0,l=[];const o=e=>{if(e&&e.data){const a=e.data;Number.isInteger(a.total)&&(r=a.total),Array.isArray(a.records)&&(l=a.records)}H.loading=!1,t({total:r,result:l})},i={teamName:a.teamName||"",deptId:S.query.id||"",size:e.pageSize,current:e.currentPage};q(i).then(o).catch(o)})))}}}),A=l({span:24,titleWidth:"100px",loading:!1,titleColon:!1,data:{id:"",teamName:"",des:"",leader:null,leaderId:"",deptId:S.query.id},items:[{field:"teamName",title:"小组名称",itemRender:{name:"$input",props:{placeholder:"请输入小组名"}}},{field:"des",title:"小组职责",itemRender:{name:"$input",props:{placeholder:"请输入小组职责"}}},{field:"leaderId",title:"小组主管",slots:{default:"leader_item"}},{align:"right",itemRender:{name:"$buttons",children:[{props:{content:"取消"},events:{click:()=>{var e;return null==(e=M.value)?void 0:e.close()}}},{props:{type:"submit",content:"确定",status:"primary"},events:{click:()=>G.onSubmitForm()}}]}}],rules:{teamName:[{required:!0,validator:({itemValue:e})=>e?e.trim()?void 0:new Error("空格无效"):new Error("请输入小组名称")}],des:[{required:!0,validator:({itemValue:e})=>e?e.trim()?void 0:new Error("空格无效"):new Error("请输入小组职责")}]}}),G=l({isUpdate:!0,commitQuery:()=>{var e;return null==(e=z.value)?void 0:e.commitProxy("query")},clearTable:()=>{var e;return null==(e=z.value)?void 0:e.reloadData([])},onShowModal:e=>{var a;e?(G.isUpdate=!0,F.title="修改小组",A.data.id=e.id,A.data.teamName=e.teamName,A.data.des=e.des,A.data.leader=e.teamLeader,A.data.deptId=S.query.id):(G.isUpdate=!1,F.title="新增小组"),null==(a=M.value)||a.open(),o((()=>{var e,a;!G.isUpdate&&(null==(e=P.value)||e.reset()),null==(a=P.value)||a.clearValidate()}))},onSubmitForm:e=>{var a;A.loading||null==(a=P.value)||a.validate((e=>{if(e)return;A.loading=!0;const a=e=>{var a;A.loading=!1,200===e.code&&(null==(a=M.value)||a.close(),x.success("操作成功"),A.data.leader=null,!G.isUpdate&&G.afterInsert(),G.commitQuery())};A.data.teamLeaderId=A.data.leader.id,G.isUpdate?_(A.data).then((e=>a(e))).catch((e=>a(e))):I(A.data).then((e=>a(e))).catch((e=>a(e))),A.data={}}))},onGoInfo:e=>{b.push({path:"/sys/team/info",query:{id:null==e?void 0:e.id}})},afterInsert:()=>{var e,a;const t=null==(a=null==(e=z.value)?void 0:e.getProxyInfo())?void 0:a.pager;if(t){t.currentPage*t.pageSize===t.total&&++t.currentPage}}});return i((()=>{D("")})),(e,a)=>{const t=d("vxe-button"),r=C,l=k,o=d("vxe-grid"),i=w,b=j,x=d("vxe-form"),q=d("vxe-modal");return s(),n("div",V,[m(o,y({ref_key:"xGridDom",ref:z},H),{"toolbar-btns":u((()=>[void 0!==p(S).query.id?(s(),c(t,{key:0,status:"primary",icon:"vxe-icon-add",onClick:a[0]||(a[0]=e=>G.onShowModal())},{default:u((()=>[v(" 新增小组 ")])),_:1})):f("",!0)])),"row-operate":u((({row:e})=>[m(r,{link:"",type:"primary",onClick:a=>G.onGoInfo(e)},{default:u((()=>[U,v(" 查看详情 ")])),_:2},1032,["onClick"]),void 0!==p(S).query.id?(s(),c(l,{key:0,direction:"vertical"})):f("",!0),void 0!==p(S).query.id?(s(),c(r,{key:1,link:"",type:"warning",onClick:a=>G.onShowModal(e)},{default:u((()=>[E,v(" 信息修改 ")])),_:2},1032,["onClick"])):f("",!0)])),_:1},16),m(q,y({ref_key:"xModalDom",ref:M},F),{default:u((()=>[m(x,y({ref_key:"xFormDom",ref:P},A),{leader_item:u((({data:e})=>[m(b,{modelValue:e.leader,"onUpdate:modelValue":a=>e.leader=a,"value-key":"id","remote-show-suffix":"",filterable:"",remote:"",clearable:"","reserve-keyword":"",placeholder:"请输入组长的姓名","remote-method":D,loading:$.value},{default:u((()=>[(s(!0),n(g,null,h(R.value,(e=>(s(),c(i,{key:e.id,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue","loading"])])),_:1},16)])),_:1},16)])}}});export{z as default};
